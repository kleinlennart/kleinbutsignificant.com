{
  "hash": "f2e675824b57af9eef40bd18d99f76f5",
  "result": {
    "markdown": "---\ntitle: GitHub Commit Difference Badge\nauthor: Lennart Klein\ndate: 2024-01-11\nslug: [commit-badge]\ncategories:\n  - Tech\ntags:\n  - utils\n  - git\n  - github\n  - R\n  - markdown\n  - snippet\n# description: \n# summary: \n# series:\n# ShowToc: yes\n# TocOpen: yes\ndraft: false # Quarto only shows non-drafts\nformat:\n  hugo-md:\n    mermaid-format: png # js, png, and svg\n    code-annotations: true\n    code-overflow: wrap\n\neditor: \n  markdown: \n    wrap: 72\n    \ncover: \n  image: \"badge_params.png\" # image path/url\n  alt: \"<alt text>\" # alt text\n  caption: \"<text>\" # display caption under cover\n  relative: false # when using page bundles set this to true\n  hidden: true # only hide on current single page\n\n# execute: \n  # enabled: true # need to manually change .md file badges because Quarto fucks them up\n  # freeze: true\n---\n\n::: {.cell hash='index_cache/markdown_strict/setup_c7a40cc038808a827dbc9d6a4ff9e14c'}\n\n:::\n\n\n### TL;DR\n\n-   Create a [Shields.io](https://shields.io/ \"https://shields.io/\")\n    badge for your GitHub `README.md` to track the number of commits\n    since a specific commit\n\n-   In my case, I set the base/reference point to the last commit to the\n    repo of my blog's\n    [theme](https://github.com/adityatelange/hugo-PaperMod/tree/master \"hugo-PaperMod\")\n    which I added as a `git submodule`[^1] to the `themes/` folder of my\n    blog[^2]\n\n-   Using [R\n    Markdown](https://rmarkdown.rstudio.com/ \"https://rmarkdown.rstudio.com/\"),\n    I have my badge automatically update to the current status of my\n    submodule and rendered out to my `README.md`\n\n-   Finally, I wrap the badge in a link to [GitHub Commit\n    Compare](https://docs.github.com/en/pull-requests/committing-changes-to-your-project/viewing-and-comparing-commits/comparing-commits \"https://docs.github.com/en/pull-requests/committing-changes-to-your-project/viewing-and-comparing-commits/comparing-commits\")\n    to quickly see all the recent changes to the theme before I pull\n    them\n\n[^1]: Learn more about submodules here:\n    <https://git-scm.com/book/en/v2/Git-Tools-Submodules>\n\n[^2]: This blog is based on\n    [{blogdown}](https://github.com/rstudio/blogdown \"https://github.com/rstudio/blogdown\")\n    and [Hugo](https://gohugo.io/ \"https://gohugo.io/\"), which uses a\n    very specific [directory\n    structure](https://gohugo.io/getting-started/directory-structure/#directories \"https://gohugo.io/getting-started/directory-structure/#directories\").\n\n[![GitHub commits since tagged\nversion](https://img.shields.io/github/commits-since/adityatelange/hugo-PaperMod/71ce72b1bfb868b406c369c958f8682c63940e01?style=flat&logo=github&label=Commits%20since%20last%20theme%20submodule%20pull%20)](https://github.com/adityatelange/hugo-PaperMod/compare/71ce72b1bfb868b406c369c958f8682c63940e01...master)\n\n### How it works\n\n\n```{mermaid}\n%%| echo: false # output mermaid code with chunk?\nflowchart LR\n  git(Get HEAD SHA with git2r) -->|Badge| rmd(README.Rmd) -->|Render| md(README.md) \n```\n\n\n-   NOTE: you can set up the baseline for this README workflow with the\n    help of `usethis::use_readme_rmd()`\n\n#### Getting the git ref\n\n\n::: {.cell hash='index_cache/markdown_strict/unnamed-chunk-2_e5d5252f79d48e640ade62a38a35e151'}\n\n```{.r .cell-code}\nget_theme_sha <- function(theme_dir = NULL) {\n  submodule <- git2r::repository(\n    path = here::here(\"themes\", theme_dir)\n  )\n\n  sha <- submodule |>\n    git2r::repository_head() |>\n    git2r::sha()\n  return(sha)\n}\n\nget_theme_sha(theme_dir = \"PaperMod\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"71ce72b1bfb868b406c369c958f8682c63940e01\"\n```\n:::\n:::\n\n\n#### Creating the badge\n\n\n::: {.cell hash='index_cache/markdown_strict/unnamed-chunk-3_37d01fbe9ca1056bcdc3c656c1846426'}\n\n```{.r .cell-code}\ncommit_badge <- function(user = NULL, repo = NULL, sha = NULL) {\n  glue::glue(\"[![GitHub commits since tagged version](https://img.shields.io/github/commits-since/{user}/{repo}/{sha}?style=flat&logo=github&label=Commits%20since%20last%20theme%20submodule%20pull)](https://github.com/{user}/{repo}/compare/{sha}...master)\")\n}\n\nbadge <- commit_badge(\n  user = \"adityatelange\",\n  repo = \"hugo-PaperMod\",\n  sha = get_theme_sha(theme_dir = \"PaperMod\")\n)\n\nbadge\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[![GitHub commits since tagged version](https://img.shields.io/github/commits-since/adityatelange/hugo-PaperMod/71ce72b1bfb868b406c369c958f8682c63940e01?style=flat&logo=github&label=Commits%20since%20last%20theme%20submodule%20pull)](https://github.com/adityatelange/hugo-PaperMod/compare/71ce72b1bfb868b406c369c958f8682c63940e01...master)\n```\n:::\n:::\n\n\nTo include the badge in your Markdown file, use [inline\ncode](https://quarto.org/docs/computations/inline-code.html \"https://quarto.org/docs/computations/inline-code.html\"):\n\n\n::: {.cell hash='index_cache/markdown_strict/unnamed-chunk-4_01df7693698d059906bc24bdfdc9858f'}\n\n```{.r .cell-code}\n`r badge`\n\n`r commit_badge(user = \"adityatelange\", repo = \"hugo-PaperMod\",\n                sha = get_theme_sha(theme_dir = \"PaperMod\"))`\n```\n:::\n\n\n[![GitHub commits since tagged version](https://img.shields.io/github/commits-since/adityatelange/hugo-PaperMod/71ce72b1bfb868b406c369c958f8682c63940e01?style=flat&logo=github&label=Commits%20since%20last%20theme%20submodule%20pull)](https://github.com/adityatelange/hugo-PaperMod/compare/71ce72b1bfb868b406c369c958f8682c63940e01...master)\n\nAlso works with `knitr::include_graphics()`\n\n\n------------------------------------------------------------------------\n\n### Appendix: The shield.io badge specs\n\n:link: <https://shields.io/badges/git-hub-commits-since-tagged-version>\n\n<!-- Badge Parameter at Shields.io -->\n\n![](badge_params.png)\n\n<!-- {{< gist kleinlennart a821c64a2ad29890bffb9a22ad03a146 >}} -->\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}